## Install nginx and php71-fpm
packages:
  yum:
    php71-fpm: []

## Lo configuramos
files:
  "/etc/php-fpm-7.1.d/www.conf" :
    mode: "000644"
    owner: root
    group: root
    content: |
      [www]
      user = webapp
      group = webapp
      listen = /var/run/php-fpm/php-fpm.sock
      listen.owner = nginx
      listen.group = nginx
      listen.mode = 0660
      listen.allowed_clients = 127.0.0.1
      pm = dynamic
      pm.max_children = 50
      pm.start_servers = 5
      pm.min_spare_servers = 5
      pm.max_spare_servers = 35
      clear_env = no
      slowlog = /var/log/php-fpm/www-slow.log
      php_admin_value[error_log] = /var/log/php-fpm/7.1/www-error.log
      php_admin_flag[log_errors] = on
      php_value[session.save_handler] = files
      php_value[session.save_path]    = /var/lib/php/7.1/session
      php_value[soap.wsdl_cache_dir]  = /var/lib/php/7.1/wsdlcache
  "/opt/elasticbeanstalk/hooks/appdeploy/post/05_RestartServer.sh" :
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      service php-fpm restart
