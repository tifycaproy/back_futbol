version: 0.2
env:
  variables:
    APP_NAME: "Millonarios FC - CodePipeline CI/CD"
phases:
 pre_build:
   commands:
     - php -m
     - php --ini
     - rm -rf vendor
     - rm -rf composer.lock
 build:
   commands:
     - composer install --no-interaction --prefer-dist
     - composer dump-autoload
     - touch database/database.sqlite
 post_build:
   commands:
     - vendor/bin/parallel-lint --exclude vendor .
     - php artisan migrate:fresh --path=database/migrations/2way --database=sqlite --force --seed
     - php artisan migrate --path=/database/migrations/v3 --database=sqlite --force
     - php artisan migrate --path=/database/migrations/v4 --database=sqlite --force
     - php artisan migrate --path=/database/migrations/v5 --database=sqlite --force
     - vendor/bin/codecept run functional
 #eb_codebuild_settings:
 #  CodeBuildServiceRole: s3-admin-access
 #  ComputeType: BUILD_GENERAL1_SMALL
 #  Image: aws/codebuild/docker:17.09.0
 #  Timeout: 60
